TYPE=TRIGGERS
triggers='CREATE DEFINER=`zxrtt`@`%` TRIGGER refunder after INSERT ON refund FOR EACH ROW \nBEGIN\nDECLARE c int;\nDECLARE a int;\nset a = (select Seat from ticket where Ticket_ID = new.Refund_Ticket_ID);\nset c = (select Selled_Num from arrangement where \nArrange_Name = (select Movie_Name from ticket where Ticket_ID = new.Refund_Ticket_ID) \nand Arrange_Screen = (select Screen from ticket where Ticket_ID = new.Refund_Ticket_ID) \nand year(date_format(Arrange_Date,\'%Y%m%d%H%i%s\')) =  year(date_format((select Movie_Time from ticket where Ticket_ID = new.Refund_Ticket_ID),\'%Y%m%d%H%i%s\')) \nand dayofyear(date_format(Arrange_Date,\'%Y%m%d%H%i%s\')) = dayofyear(date_format((select Movie_Time from ticket where Ticket_ID = new.Refund_Ticket_ID),\'%Y%m%d%H%i%s\')) \nand hour(date_format(Arrange_Time,\'%Y%m%d%H%i%s\')) = hour(date_format((select Movie_Time from ticket where Ticket_ID = new.Refund_Ticket_ID),\'%Y%m%d%H%i%s\')) \nand minute(date_format(Arrange_Time,\'%Y%m%d%H%i%s\')) = minute(date_format((select Movie_Time from ticket where Ticket_ID = new.Refund_Ticket_ID),\'%Y%m%d%H%i%s\') )\nand second(date_format(Arrange_Time,\'%Y%m%d%H%i%s\')) = second(date_format((select Movie_Time from ticket where Ticket_ID = new.Refund_Ticket_ID),\'%Y%m%d%H%i%s\')));\nif a = c then\nUPDATE\narrangement SET Selled_Num = c - 1 WHERE\nArrange_Name = (select Movie_Name from ticket where Ticket_ID = new.Refund_Ticket_ID) \nand Arrange_Screen = (select Screen from ticket where Ticket_ID = new.Refund_Ticket_ID) \nand year(date_format(Arrange_Date,\'%Y%m%d%H%i%s\')) =  year(date_format((select Movie_Time from ticket where Ticket_ID = new.Refund_Ticket_ID),\'%Y%m%d%H%i%s\')) \nand dayofyear(date_format(Arrange_Date,\'%Y%m%d%H%i%s\')) = dayofyear(date_format((select Movie_Time from ticket where Ticket_ID = new.Refund_Ticket_ID),\'%Y%m%d%H%i%s\')) \nand hour(date_format(Arrange_Time,\'%Y%m%d%H%i%s\')) = hour(date_format((select Movie_Time from ticket where Ticket_ID = new.Refund_Ticket_ID),\'%Y%m%d%H%i%s\')) \nand minute(date_format(Arrange_Time,\'%Y%m%d%H%i%s\')) = minute(date_format((select Movie_Time from ticket where Ticket_ID = new.Refund_Ticket_ID),\'%Y%m%d%H%i%s\'))\nand second(date_format(Arrange_Time,\'%Y%m%d%H%i%s\')) = second(date_format((select Movie_Time from ticket where Ticket_ID = new.Refund_Ticket_ID),\'%Y%m%d%H%i%s\'));\nend if;\nEND'
sql_modes=1436549152
definers='zxrtt@%'
client_cs_names='utf8mb4'
connection_cl_names='utf8mb4_unicode_ci'
db_cl_names='latin1_swedish_ci'
created=148349969108
